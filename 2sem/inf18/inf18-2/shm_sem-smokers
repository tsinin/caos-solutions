В баре сидят три курильщика - ценители самокруток из табака и бумаги. У каждого из них что-нибудь не хватает для полного счастья: первый (T) забыл дома табак, второй (P) - бумагу, третий (M) - спички. Видя страдания курильщиков, бармен периодически роется среди своих вещей, и что-нибудь находит, выдаваю недостающий предмет одному из курильщиков. Как только табак, бумага и спички у бармена заканчиваются, он всех выгоняет, разрешая докурить самокрутку тому, кто уже успех закурить.

Смоделируйте эту задачу. Каждый персонаж - это отдельный процесс: три курильщика и бармен.

На стандартный поток ввода подается последовательность латинских букв: t, p и m, - вещи, которые удается найти бармену, чтобы осчастливить одного из курильщиков. Как только последовательность букв заканчивается, то бармен всех выгоняет, отправляя им сигнал SIGTERM.

Каждый курильщик, получив недостающий предмет, выкуривает самокрутку, записывая на стандартный поток вывода одну из букв латинского алфавита: T, P или M, - что ему не хватало. Если используется высокоуровневый ввод-вывод, не забывайте сбрасывать стандартный поток вывода.

Бармен можен взаимодействовать одновременно только с одним курильщиком. Пока курильщики заняты своим делом, и не нуждаются в помощи, он отдыхает.

Когда курильщики выкуривают самокрутку, они должны игнорировать просьбу бармена покинуть помещение, а моделирующие их процессы - завершить свою работу после того, как будет завершена операция вывода символа.

Для реализации используйте семафоры POSIX, которые располагаются в общей для всех процессов памяти.
